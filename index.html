<!-- Back-up Code(With UI and UX) -->
<!DOCTYPE html>
<!-- Add data-theme="dark" for default dark mode, or JS will handle it -->
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habit Tracker - Material You</title>
    <!-- 1. FONT: Use Roboto + Google Sans (for expressive headlines) -->
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&family=Google+Sans:wght@400;500&display=swap"
        rel="stylesheet">

    <!-- 2. ICONS: Switched to Material Symbols Outlined per new principles -->
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
        rel="stylesheet">

    <!-- 3. CHART.JS: For advanced analytics visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <style>
        /* ---
         * NEW DESIGN SYSTEM (Based on your M3 Expressive Principles)
         * ---
         */

        /* 1. Static Dynamic Color System & 6. Tonal Hierarchy */
        :root {
            /* Primary Palette */
            --color-primary: #1A73E8;
            --color-primary-hover: #1765CC;
            --color-primary-container: rgba(26, 115, 232, 0.08);
            /* For flash */
            --color-on-primary: #FFFFFF;

            /* Secondary (Neutral) Palette */
            --color-secondary: #5F6368;
            --color-on-secondary: #FFFFFF;

            /* REFINEMENT: Principle 6 - Accent Color */
            --color-accent-gold: #FBBC04;
            --color-on-accent-gold: #202124;

            /* Status Colors */
            --color-error: #EA4335;
            --color-on-error: #FFFFFF;
            --color-success: #34A853;
            --color-warning: #FBBC04;

            /* Surface & Tones */
            --color-surface: #FFFFFF;
            --color-on-surface: #202124;
            --color-on-surface-variant: #5F6368;
            /* Using secondary for variant text */

            /* Tonal surfaces from principle 6, mapped to names from principle 1 */
            --color-surface-tone-1: #FFFFFF;
            /* --tone-surface-1 */
            --color-surface-tone-2: #F8F9FA;
            /* --tone-surface-2 */
            --color-surface-tone-3: #E8EAED;
            /* --tone-surface-3 */

            /* --color-surface-elevated from principle 1 */
            --color-surface-elevated: #F8F9FA;

            /* Outline */
            --color-outline: #DADCE0;
            --color-outline-faint: rgba(60, 64, 67, 0.1);
            /* For dots */

            /* 2. Simplified Shape System */
            --radius-small: 4px;
            --radius-medium: 8px;
            --radius-large: 12px;
            --radius-extra: 16px;
            --radius-full: 9999px;

            /* 4. Expressive Motion */
            --motion-fast: 150ms ease-out;
            --motion-medium: 250ms cubic-bezier(0.2, 0, 0, 1);
            --motion-slow: 400ms cubic-bezier(0.2, 0, 0, 1);

            /* 5. Static Expressive Typography */
            /* Using 'Google Sans' for expressive, 'Roboto' for body */
            --font-display: 57px/1.2 'Google Sans', sans-serif;
            --font-headline: 32px/1.25 'Google Sans', sans-serif;
            --font-title: 22px/1.3 'Google Sans', sans-serif;
            --font-body: 16px/1.6 'Roboto', sans-serif;
            --font-label: 14px/1.4 'Roboto', sans-serif;
            --font-weight-regular: 400;
            --font-weight-medium: 500;
        }

        /* Dark Theme (from Principle 1) */
        /* Applied via body.dark-mode instead of data-theme */
        body.dark-mode {
            --color-primary: #8AB4F8;
            --color-primary-hover: #a3c5f8;
            --color-primary-container: rgba(138, 180, 248, 0.1);
            /* For flash */
            --color-on-primary: #202124;

            --color-secondary: #E8EAED;

            --color-surface: #202124;
            --color-on-surface: #E8EAED;
            --color-on-surface-variant: #DADCE0;

            --color-surface-tone-1: #202124;
            --color-surface-tone-2: #2A2B2F;
            --color-surface-tone-3: #343538;

            --color-surface-elevated: #2A2B2F;

            --color-outline: #5F6368;
            --color-outline-faint: rgba(232, 234, 237, 0.1);
            /* For dots */
        }

        /* ---
         * UTILITY CLASSES
         * ---
         */

        /* 3. Tonal Elevation & Shadows */
        .elevation-1 {
            background: var(--color-surface);
            box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3);
        }

        .elevation-2 {
            background: var(--color-surface-elevated);
            box-shadow: 0 2px 6px rgba(60, 64, 67, 0.25);
        }

        .elevation-3 {
            background: var(--color-surface-elevated);
            box-shadow: 0 4px 8px rgba(60, 64, 67, 0.25);
        }

        /* 4. Expressive Motion Keyframes */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(4px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* 8. State Layer (for buttons) */
        .state-layer-primary::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: inherit;
            /* Inherit button's border-radius */
            background: rgba(26, 115, 232, 0);
            /* --color-primary as RGB */
            transition: background var(--motion-fast);
        }

        .state-layer-primary:hover::after {
            background: rgba(26, 115, 232, 0.08);
        }

        .state-layer-primary:active::after {
            background: rgba(26, 115, 232, 0.12);
        }

        /* State layer for neutral/text buttons */
        .state-layer-secondary::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: inherit;
            background: rgba(95, 99, 104, 0);
            /* --color-secondary as RGB */
            transition: background var(--motion-fast);
        }

        .state-layer-secondary:hover::after {
            background: rgba(95, 99, 104, 0.08);
        }

        .state-layer-secondary:active::after {
            background: rgba(95, 99, 104, 0.12);
        }

        /* State layer for white-on-primary buttons */
        .state-layer-on-primary::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: inherit;
            background: rgba(255, 255, 255, 0);
            transition: background var(--motion-fast);
        }

        .state-layer-on-primary:hover::after {
            background: rgba(255, 255, 255, 0.1);
        }

        .state-layer-on-primary:active::after {
            background: rgba(255, 255, 255, 0.15);
        }

        /* State layer for dark mode toggle */
        body.dark-mode .state-layer-on-primary:hover::after {
            background: rgba(138, 180, 248, 0.1);
        }

        /* #8AB4F8 */
        body.dark-mode .state-layer-on-primary:active::after {
            background: rgba(138, 180, 248, 0.15);
        }

        /* ---
         * BASE STYLES
         * ---
         */

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            /* 5. Typography: Use --font-body */
            font: var(--font-body);
            background-color: var(--color-surface);
            color: var(--color-on-surface);
            min-height: 100vh;
            padding: 0;
            overflow-x: hidden;
            transition: background-color var(--motion-fast), color var(--motion-fast);

            /* REFINEMENT: Principle 1 & 5 - Add subtle dot pattern */
            background-image: radial-gradient(var(--color-outline-faint) 0.5px, transparent 0.5px);
            background-size: 8px 8px;
        }

        /* 7. Optimized Icon System */
        /* Targets the existing class but applies new principles */
        .material-symbols-rounded,
        .material-symbols-outlined {
            font-family: 'Material Symbols Outlined';
            /* Use Outlined */
            font-size: 24px;
            font-variation-settings:
                'FILL' 0,
                'wght' 400,
                'GRAD' 0,
                'opsz' 24;
            color: var(--color-secondary);
            vertical-align: middle;
            user-select: none;
        }

        /* 11. Accessibility Optimizations */
        :focus-visible {
            outline: 2px solid var(--color-primary);
            outline-offset: 2px;
            border-radius: var(--radius-small);
        }

        @media (prefers-reduced-motion: reduce) {
            * {
                animation: none !important;
                transition: none !important;
            }
        }

        /* ---
         * COMPONENT STYLES
         * ---
         */

        /* --- Login Modal --- */
        .auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--color-surface-tone-3);
            /* Use tone */
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            opacity: 0;
            visibility: hidden;
            transition: opacity var(--motion-medium), visibility var(--motion-medium), background-color var(--motion-fast);
        }

        .auth-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .auth-modal {
            /* Use elevation and shape */
            background: var(--color-surface);
            border-radius: var(--radius-large);
            /* 12px */
            padding: 32px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 4px 8px rgba(60, 64, 67, 0.25);
            /* elevation-3 */
            text-align: center;
            animation: fadeIn var(--motion-medium) forwards;
            transition: background-color var(--motion-fast);
        }

        .auth-title {
            /* 5. Typography */
            font: var(--font-title);
            color: var(--color-on-surface);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .auth-title .material-symbols-outlined {
            color: var(--color-primary);
            font-size: 28px;
        }

        .auth-subtitle {
            font: var(--font-label);
            font-size: 16px;
            /* A bit bigger */
            color: var(--color-on-surface-variant);
            margin-bottom: 24px;
        }

        .input-group {
            margin-bottom: 16px;
            text-align: left;
        }

        .input-label {
            font: var(--font-label);
            color: var(--color-primary);
            margin-bottom: 8px;
            display: block;
            font-weight: var(--font-weight-medium);
            padding-left: 16px;
        }

        .input-field {
            width: 100%;
            padding: 16px;
            font: var(--font-body);
            border: 2px solid var(--color-outline);
            border-radius: var(--radius-medium);
            /* 8px */
            background: var(--color-surface-tone-2);
            color: var(--color-on-surface);
            transition: border-color var(--motion-fast), box-shadow var(--motion-fast), background-color var(--motion-fast), color var(--motion-fast);
        }

        .input-field:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 2px var(--color-primary-hover);
        }

        .auth-actions {
            display: flex;
            gap: 12px;
            flex-direction: column;
            margin-top: 16px;
        }

        .toggle-auth {
            background: none;
            border: none;
            color: var(--color-primary);
            font: var(--font-label);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            padding: 8px;
            border-radius: var(--radius-full);
            position: relative;
            overflow: hidden;
        }

        .auth-error {
            font: var(--font-label);
            color: var(--color-error);
            margin-top: 16px;
            display: none;
        }

        /* --- Main App --- */
        .app-container {
            display: none;
        }

        .app-container.show {
            display: block;
        }

        /* App Bar */
        .app-bar {
            background: var(--color-primary);
            color: var(--color-on-primary);
            padding: 24px 20px;
            /* Use shadow for depth */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
            transition: box-shadow var(--motion-fast);
        }

        /* NEW: Dynamic app bar shadow on scroll */
        .app-bar.scrolled {
            box-shadow: 0 2px 6px rgba(60, 64, 67, 0.25);
            /* elevation-2 */
        }

        .app-bar-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .app-title {
            /* 5. Typography: --font-headline */
            font: var(--font-headline);
            letter-spacing: 0;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .app-title .material-symbols-outlined {
            color: var(--color-on-primary);
            font-size: 32px;
        }

        .app-subtitle {
            font: var(--font-label);
            font-size: 16px;
            opacity: 0.9;
            font-weight: var(--font-weight-regular);
        }

        .app-bar-actions {
            display: flex;
            align-items: center;
            gap: 8px;
            /* Reduced gap */
        }

        .sync-status {
            display: flex;
            align-items: center;
            justify-content: center;
            /* Center the icon */
            gap: 8px;
            padding: 8px;
            /* Reduced padding for icon-only */
            background: rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-full);
            font: var(--font-label);
            backdrop-filter: blur(10px);
            width: 40px;
            /* Fixed size for circle */
            height: 40px;
        }

        .sync-status .material-symbols-outlined {
            color: var(--color-on-primary);
            font-size: 20px;
            /* Slightly smaller icon */
            margin: 0;
            /* Remove potential margins */
        }

        .sync-status.syncing .material-symbols-outlined {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* General Buttons */
        .filled-button,
        .outlined-button,
        .today-button,
        .text-button,
        .icon-button {
            position: relative;
            overflow: hidden;
            cursor: pointer;
            border: none;
            font-weight: var(--font-weight-medium);
            letter-spacing: 0.5px;
            transition: transform var(--motion-fast), box-shadow var(--motion-fast), background-color var(--motion-fast), color var(--motion-fast), border-color var(--motion-fast);
            -webkit-tap-highlight-color: transparent;
        }

        .filled-button:active,
        .outlined-button:active,
        .today-button:active,
        .text-button:active,
        .icon-button:active {
            transform: scale(0.97);
        }

        /* 8. State Layers applied */
        .filled-button,
        .today-button {
            background: var(--color-primary);
            color: var(--color-on-primary);
            padding: 12px 24px;
            border-radius: var(--radius-full);
            /* Rounded */
            font: var(--font-label);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .filled-button:hover,
        .today-button:hover {
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .filled-button:disabled,
        .today-button:disabled {
            background: var(--color-outline);
            color: var(--color-on-surface-variant);
            box-shadow: none;
            transform: none;
            cursor: not-allowed;
        }

        .outlined-button {
            background: transparent;
            color: var(--color-primary);
            border: 1px solid var(--color-outline);
            padding: 12px 24px;
            border-radius: var(--radius-full);
            /* Rounded */
            font: var(--font-label);
        }

        .outlined-button:hover {
            background: rgba(26, 115, 232, 0.08);
            /* state-layer-primary hover */
        }

        .icon-button {
            background: var(--color-surface-tone-2);
            color: var(--color-on-surface-variant);
            width: 48px;
            height: 48px;
            border-radius: var(--radius-full);
            /* Circle */
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .icon-button .material-symbols-outlined {
            color: var(--color-on-surface-variant);
            font-size: 24px;
            transition: color var(--motion-fast);
        }

        .icon-button:hover {
            background: var(--color-surface-tone-3);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
        }

        .icon-button:disabled {
            background: var(--color-surface-tone-2);
            opacity: 0.5;
            cursor: not-allowed;
        }

        .text-button {
            background: none;
            color: var(--color-on-primary);
            font: var(--font-label);
            font-weight: var(--font-weight-medium);
            padding: 10px 12px;
            border-radius: var(--radius-full);
        }

        /* Dark mode toggle button style */
        .theme-toggle-button {
            background: none;
            border: none;
            color: var(--color-on-primary);
            width: 40px;
            height: 40px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-toggle-button .material-symbols-outlined {
            color: var(--color-on-primary);
            font-size: 20px;
        }

        body.dark-mode .theme-toggle-button .material-symbols-outlined {
            color: var(--color-primary);
            /* #8AB4F8 */
        }

        /* Hide one icon based on theme */
        body:not(.dark-mode) #icon-dark-mode {
            display: none;
        }

        body.dark-mode #icon-light-mode {
            display: none;
        }

        /* --- Container & Cards --- */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px 20px;
        }

        .setup-banner {
            background: var(--color-warning);
            /* Use warning color */
            border-radius: var(--radius-large);
            padding: 24px;
            margin-bottom: 24px;
            display: none;
            animation: fadeIn var(--motion-medium);
            color: var(--color-on-surface);
            /* Text on warning */
        }

        .setup-banner.show {
            display: block;
        }

        .setup-banner h3 {
            font: var(--font-title);
        }

        .setup-banner p {
            font: var(--font-label);
            line-height: 1.6;
        }

        .setup-banner a {
            color: var(--color-primary);
        }

        .date-card {
            /* REFINEMENT: Principle #1 - Use prominent background tint */
            background: var(--color-surface-tone-2);
            border-radius: var(--radius-large);
            /* 12px */
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3);
            /* elevation-1 */
            animation: fadeIn var(--motion-medium) forwards;
        }

        .date-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .current-date {
            font: var(--font-headline);
        }

        .date-subtext {
            font: var(--font-label);
            color: var(--color-on-surface-variant);
            min-height: 20px;
            /* Reserve space for microcopy */
            transition: all var(--motion-fast);
        }

        .date-nav {
            display: flex;
            justify-content: center;
            gap: 12px;
            align-items: center;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            /* REFINEMENT: Principle #1 - Use 8dp grid system (16px gap) */
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--color-surface-tone-2);
            /* REFINEMENT: Principle #1 - Use 16-24dp radius */
            border-radius: var(--radius-extra);
            /* 16px */
            padding: 20px;
            text-align: center;
            transition: all var(--motion-fast);
            animation: fadeIn var(--motion-medium) forwards;
            animation-delay: calc(var(--index, 1) * 50ms);
            /* Stagger */
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 6px rgba(60, 64, 67, 0.25);
            /* elevation-2 */
        }

        .stat-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .stat-icon .material-symbols-outlined {
            font-size: 32px;
            font-variation-settings: 'FILL' 1;
        }

        /* REFINEMENT: Principle #4 - Color-coded icons */
        #weekProgressIcon .material-symbols-outlined {
            color: var(--color-primary);
        }

        #totalCheckinsIcon .material-symbols-outlined {
            color: var(--color-accent-gold);
        }

        #bestStreakIcon .material-symbols-outlined {
            color: var(--color-error);
        }

        #avgCompletionIcon .material-symbols-outlined {
            color: var(--color-success);
        }

        .stat-value {
            font: var(--font-headline);
            margin-bottom: 4px;
        }

        .stat-label {
            font: var(--font-label);
            color: var(--color-on-surface-variant);
            text-transform: uppercase;
        }

        /* Habits List */
        .habits-section {
            background: var(--color-surface-tone-2);
            border-radius: var(--radius-large);
            /* 12px */
            padding: 8px;
            margin-bottom: 24px;
            box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3);
            /* elevation-1 */
            min-height: 100px;
        }

        .habits-list-empty-state {
            padding: 40px 24px;
            text-align: center;
            color: var(--color-on-surface-variant);
        }

        .habits-list-empty-state .material-symbols-outlined {
            font-size: 48px;
            color: var(--color-outline);
        }

        .habits-list-empty-state h3 {
            font: var(--font-title);
        }

        .habits-list-empty-state p {
            font: var(--font-label);
            font-size: 16px;
        }

        .habit-card {
            background: var(--color-surface);
            border-radius: var(--radius-medium);
            /* 8px */
            padding: 20px;
            margin: 8px;
            display: flex;
            align-items: center;
            gap: 16px;
            transition: all var(--motion-fast);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            box-shadow: 0 1px 2px rgba(60, 64, 67, 0.2);
        }

        /* REFINEMENT: Principle 7 - Flash animation */
        .habit-card.flash {
            animation: flash-accent var(--motion-slow);
        }

        @keyframes flash-accent {
            0% {
                background-color: var(--color-primary-container);
            }

            100% {
                background-color: var(--color-surface);
            }
        }

        body.dark-mode .habit-card.flash {
            animation: flash-accent-dark var(--motion-slow);
        }

        @keyframes flash-accent-dark {
            0% {
                background-color: var(--color-primary-container);
            }

            100% {
                background-color: var(--color-surface);
            }
        }

        .habit-card:hover {
            box-shadow: 0 2px 6px rgba(60, 64, 67, 0.25);
            /* elevation-2 */
            transform: translateY(-1px);
        }

        .habit-card.completed {
            background: var(--color-surface-tone-3);
        }

        .habit-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--habit-color);
            border-radius: 4px 0 0 4px;
        }

        /* Custom Checkbox */
        .habit-checkbox-wrapper {
            width: 28px;
            height: 28px;
            flex-shrink: 0;
            z-index: 2;
        }

        .habit-checkbox {
            appearance: none;
            width: 28px;
            height: 28px;
            border: 2px solid var(--color-outline);
            border-radius: var(--radius-medium);
            /* 8px */
            cursor: pointer;
            position: relative;
            transition: all var(--motion-fast);
            background: var(--color-surface);
        }

        .habit-checkbox:checked {
            background: var(--habit-color);
            border-color: var(--habit-color);
        }

        .habit-checkbox:checked::after {
            content: 'âœ“';
            position: absolute;
            color: white;
            font-size: 18px;
            font-weight: bold;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            /* REFINEMENT: Principle #5 - Check animation */
            animation: checkPop 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* REFINEMENT: Principle #5 - Keyframes for check */
        @keyframes checkPop {
            0% {
                transform: translate(-50%, -50%) scale(0);
            }

            50% {
                transform: translate(-50%, -50%) scale(1.2);
            }

            100% {
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .habit-checkbox:hover {
            border-color: var(--color-primary);
        }

        .habit-checkbox:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .habit-icon {
            font-size: 32px;
            flex-shrink: 0;
            pointer-events: none;
        }

        .habit-content {
            flex: 1;
            min-width: 0;
            pointer-events: none;
            padding-bottom: 12px;
            /* Space for progress bar */
        }

        .habit-name {
            font: var(--font-body);
            font-size: 18px;
            font-weight: var(--font-weight-medium);
        }

        .habit-schedule {
            font: var(--font-label);
            color: var(--color-on-surface-variant);
        }

        /* REFINEMENT: Principle 4 - "Why" text */
        .habit-why {
            font: var(--font-label);
            color: var(--color-primary);
            font-style: italic;
            font-size: 13px;
            margin-top: 4px;
            opacity: 0.9;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* REFINEMENT: Principle 3 - Progress Bar */
        .habit-progress-bar-container {
            position: absolute;
            bottom: 8px;
            left: 20px;
            right: 20px;
            height: 6px;
            background: var(--color-outline);
            border-radius: var(--radius-full);
            overflow: hidden;
        }

        .habit-progress-bar {
            height: 100%;
            width: 0%;
            /* Set by JS */
            background: var(--color-primary);
            border-radius: var(--radius-full);
            transition: width var(--motion-slow);
        }

        .habit-menu {
            z-index: 2;
        }

        .habit-menu .icon-button {
            background: transparent;
            box-shadow: none;
        }

        .habit-menu .icon-button:hover {
            background: var(--color-surface-tone-3);
        }

        /* Dropdown Menu */
        .dropdown {
            position: relative;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            top: 44px;
            background-color: var(--color-surface);
            min-width: 160px;
            box-shadow: 0 4px 8px rgba(60, 64, 67, 0.25);
            /* elevation-3 */
            border-radius: var(--radius-large);
            /* 12px */
            z-index: 10;
            padding: 8px;
            border: 1px solid var(--color-outline);
            animation: fadeIn 100ms ease-out;
        }

        .dropdown-content.show {
            display: block;
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 12px;
            font: var(--font-label);
            color: var(--color-on-surface);
            padding: 12px;
            border-radius: var(--radius-medium);
            cursor: pointer;
            background: none;
            border: none;
            width: 100%;
            text-align: left;
            position: relative;
            overflow: hidden;
        }

        .dropdown-item .material-symbols-outlined {
            color: var(--color-on-surface-variant);
        }

        .dropdown-item:hover {
            background-color: var(--color-surface-tone-2);
        }

        .dropdown-item.delete {
            color: var(--color-error);
        }

        .dropdown-item.delete .material-symbols-outlined {
            color: var(--color-error);
        }

        .dropdown-item.delete:hover {
            background-color: rgba(234, 67, 53, 0.1);
        }

        /* Export Section */
        .export-section {
            background: var(--color-surface-tone-2);
            border-radius: var(--radius-large);
            padding: 24px;
            text-align: center;
        }

        .export-section h3 {
            font: var(--font-title);
        }

        .export-section p {
            font: var(--font-label);
            color: var(--color-on-surface-variant);
            margin-bottom: 16px;
        }

        /* REFINEMENT: Principle #6 - Privacy note */
        .export-privacy-note {
            font: var(--font-label);
            font-size: 12px;
            color: var(--color-on-surface-variant);
            margin-top: 16px;
        }

        /* Progress Ring */
        .progress-ring-container {
            position: relative;
            width: 120px;
            height: 120px;
            margin: 20px auto;
        }

        /* REFINEMENT: Principle 1 - Pop animation */
        .progress-ring-container.pop {
            animation: pop 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes pop {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }

            100% {
                transform: scale(1);
            }
        }

        .progress-ring {
            transform: rotate(-90deg);
        }

        .progress-ring-circle {
            /* REFINEMENT: Principle #3 - Animate progress ring */
            transition: stroke-dashoffset var(--motion-slow);
            fill: none;
            stroke-width: 8;
            stroke-linecap: round;
        }

        .progress-ring-bg {
            fill: none;
            stroke: var(--color-outline);
            stroke-width: 8;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font: var(--font-headline);
            color: var(--color-primary);
        }

        /* Celebration */
        .celebration {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--color-surface);
            color: var(--color-on-surface);
            padding: 32px;
            border-radius: var(--radius-extra);
            /* 16px */
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            text-align: center;
            display: none;
        }

        .celebration.show {
            display: block;
            animation: celebrationPop var(--motion-slow);
        }

        /* REFINEMENT: Principle #8 - Celebration animation */
        @keyframes celebrationPop {
            0% {
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 0;
            }

            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }

        .celebration-emoji {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .celebration-text {
            font: var(--font-title);
        }

        .celebration-subtext {
            font: var(--font-label);
            color: var(--color-on-surface-variant);
        }

        /* REFINEMENT: Principle 7 - Confetti */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1001;
            pointer-events: none;
            overflow: hidden;
        }

        .confetti {
            position: absolute;
            top: -10px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            opacity: 0.8;
            animation: fall 3s linear forwards;
        }

        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .app-title {
                font: var(--font-title);
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .date-nav {
                flex-direction: column;
            }

            .today-button {
                width: 100%;
            }

            .app-bar-content {
                flex-direction: column;
                gap: 12px;
                align-items: flex-start;
            }

            .app-bar-actions {
                width: 100%;
                justify-content: space-between;
            }
        }

        /* Fab Button */
        .fab {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 56px;
            height: 56px;
            background: var(--color-primary);
            color: var(--color-on-primary);
            border: none;
            border-radius: var(--radius-extra);
            /* 16px */
            box-shadow: 0 4px 8px rgba(60, 64, 67, 0.25);
            /* elevation-3 */
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            transition: all var(--motion-medium);
        }

        .fab .material-symbols-outlined {
            color: var(--color-on-primary);
            font-size: 24px;
        }

        .fab:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 16px rgba(60, 64, 67, 0.4);
        }

        .fab:active {
            transform: scale(0.95);
        }

        /* Snackbar */
        .snackbar {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #323232;
            /* Standard snackbar color */
            color: #FFFFFF;
            padding: 16px 24px;
            border-radius: var(--radius-medium);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 1001;
            transition: transform var(--motion-medium);
            display: flex;
            align-items: center;
            gap: 12px;
            font: var(--font-label);
        }

        .snackbar .material-symbols-outlined {
            color: var(--color-success);
        }

        .snackbar.show {
            transform: translateX(-50%) translateY(0);
        }

        /* Modal Base */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 900;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            opacity: 0;
            visibility: hidden;
            transition: opacity var(--motion-medium), visibility var(--motion-medium);
            backdrop-filter: blur(5px);
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--color-surface);
            border-radius: var(--radius-large);
            /* 12px */
            padding: 24px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            opacity: 0;
            transform: scale(0.9);
            transition: opacity var(--motion-medium), transform var(--motion-medium), background-color var(--motion-fast);
        }

        .modal-overlay.show .modal {
            opacity: 1;
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .modal-title {
            font: var(--font-title);
        }

        .modal-body {
            margin-bottom: 24px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        /* Color Picker */
        .color-picker {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 16px;
        }

        .color-swatch {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-full);
            cursor: pointer;
            border: 2px solid transparent;
            transition: all var(--motion-fast);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .color-swatch.selected {
            border-color: var(--color-primary);
            transform: scale(1.1);
        }

        /* Form Styles (re-used in modal) */
        .form-group {
            margin-bottom: 16px;
            text-align: left;
        }

        .form-label {
            font: var(--font-label);
            font-weight: var(--font-weight-medium);
            color: var(--color-on-surface-variant);
        }

        .form-input,
        .form-select {
            width: 100%;
            padding: 14px 16px;
            font: var(--font-body);
            border: 1px solid var(--color-outline);
            border-radius: var(--radius-medium);
            background: var(--color-surface-tone-2);
            color: var(--color-on-surface);
            transition: all var(--motion-fast);
        }

        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 2px var(--color-primary-hover);
        }

        .form-select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' height='24px' viewBox='0 0 24 24' width='24px' fill='%235F6368'%3E%3Cpath d='M0 0h24v24H0z' fill='none'/%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
        }

        body.dark-mode .form-select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' height='24px' viewBox='0 0 24 24' width='24px' fill='%23DADCE0'%3E%3Cpath d='M0 0h24v24H0z' fill='none'/%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
        }

        /* Heatmap Modal */
        #heatmapModal .modal {
            max-width: 90%;
            width: auto;
        }

        .heatmap-grid {
            display: grid;
            grid-template-columns: repeat(26, 16px);
            grid-template-rows: repeat(7, 16px);
            grid-auto-flow: column;
            grid-gap: 3px;
            justify-content: center;
            margin-top: 16px;
            padding-right: 16px;
        }

        .heatmap-day {
            width: 16px;
            height: 16px;
            background-color: var(--color-surface-tone-2);
            border-radius: var(--radius-small);
            position: relative;
        }

        .heatmap-day.filled {
            background-color: var(--habit-color);
        }

        .heatmap-day.na {
            background-color: transparent;
        }

        .heatmap-day.missed {
            background-color: var(--color-surface-tone-3);
        }

        .heatmap-day.today {
            border: 1px solid var(--color-primary);
        }

        .heatmap-legend {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-top: 16px;
            font: var(--font-label);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: var(--radius-small);
        }

        /* ---
         * ANALYTICS DASHBOARD STYLES
         * ---
         */

        /* Analytics Navigation Tabs */
        .analytics-tabs {
            background: var(--color-surface-tone-2);
            border-radius: var(--radius-large);
            padding: 8px;
            margin-bottom: 24px;
            display: flex;
            gap: 8px;
            overflow-x: auto;
            box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3);
        }

        .analytics-tab {
            background: transparent;
            color: var(--color-on-surface-variant);
            border: none;
            padding: 12px 20px;
            border-radius: var(--radius-medium);
            font: var(--font-label);
            font-weight: var(--font-weight-medium);
            cursor: pointer;
            transition: all var(--motion-fast);
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .analytics-tab:hover {
            background: var(--color-surface-tone-3);
        }

        .analytics-tab.active {
            background: var(--color-primary);
            color: var(--color-on-primary);
        }

        .analytics-tab .material-symbols-outlined {
            font-size: 20px;
        }

        /* Analytics Content Sections */
        .analytics-content {
            display: none;
        }

        .analytics-content.active {
            display: block;
            animation: fadeIn var(--motion-medium) forwards;
        }

        /* Chart Containers */
        .chart-card {
            background: var(--color-surface-tone-2);
            border-radius: var(--radius-large);
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3);
        }

        .chart-card h3 {
            font: var(--font-title);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chart-card h3 .material-symbols-outlined {
            color: var(--color-primary);
            font-size: 24px;
        }

        .chart-wrapper {
            position: relative;
            height: 300px;
            margin-top: 16px;
        }

        .chart-wrapper.small {
            height: 200px;
        }

        .chart-wrapper.large {
            height: 400px;
        }

        /* Analytics Stats Mini Grid */
        .analytics-mini-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin-bottom: 24px;
        }

        .mini-stat-card {
            background: var(--color-surface-tone-2);
            border-radius: var(--radius-medium);
            padding: 16px;
            text-align: center;
        }

        .mini-stat-value {
            font: var(--font-title);
            color: var(--color-primary);
            margin-bottom: 4px;
        }

        .mini-stat-label {
            font: var(--font-label);
            font-size: 12px;
            color: var(--color-on-surface-variant);
            text-transform: uppercase;
        }

        /* Heatmap Filters */
        .heatmap-filters {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-group label {
            font: var(--font-label);
            color: var(--color-on-surface-variant);
            font-weight: var(--font-weight-medium);
        }

        .filter-select {
            padding: 8px 12px;
            font: var(--font-label);
            border: 1px solid var(--color-outline);
            border-radius: var(--radius-medium);
            background: var(--color-surface);
            color: var(--color-on-surface);
            cursor: pointer;
            transition: all var(--motion-fast);
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 2px var(--color-primary-container);
        }

        /* Enhanced Heatmap Grid */
        .enhanced-heatmap-grid {
            display: grid;
            grid-template-columns: 40px repeat(auto-fill, 14px);
            grid-auto-rows: 14px;
            grid-gap: 3px;
            justify-content: start;
            margin-top: 16px;
            font: var(--font-label);
            font-size: 10px;
        }

        .heatmap-day-label {
            text-align: right;
            padding-right: 8px;
            color: var(--color-on-surface-variant);
            font: var(--font-label);
            font-size: 10px;
            line-height: 14px;
        }

        .heatmap-month-label {
            color: var(--color-on-surface-variant);
            font: var(--font-label);
            font-size: 10px;
            text-align: center;
            margin-bottom: 4px;
        }

        .enhanced-heatmap-day {
            width: 14px;
            height: 14px;
            border-radius: var(--radius-small);
            background: var(--color-surface-tone-3);
            transition: all var(--motion-fast);
            cursor: pointer;
            position: relative;
        }

        .enhanced-heatmap-day:hover {
            transform: scale(1.3);
            z-index: 10;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .enhanced-heatmap-day.intensity-1 {
            opacity: 0.25;
        }

        .enhanced-heatmap-day.intensity-2 {
            opacity: 0.5;
        }

        .enhanced-heatmap-day.intensity-3 {
            opacity: 0.75;
        }

        .enhanced-heatmap-day.intensity-4 {
            opacity: 1;
        }

        .enhanced-heatmap-day.filled {
            background: var(--color-primary);
        }

        /* Heatmap Tooltip */
        .heatmap-tooltip {
            position: absolute;
            background: var(--color-surface);
            color: var(--color-on-surface);
            padding: 8px 12px;
            border-radius: var(--radius-medium);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            font: var(--font-label);
            font-size: 12px;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity var(--motion-fast);
            border: 1px solid var(--color-outline);
        }

        .heatmap-tooltip.show {
            opacity: 1;
        }

        /* Comparison Table */
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
            font: var(--font-label);
        }

        .comparison-table th {
            background: var(--color-surface-tone-3);
            padding: 12px;
            text-align: left;
            font-weight: var(--font-weight-medium);
            border-bottom: 2px solid var(--color-outline);
        }

        .comparison-table td {
            padding: 12px;
            border-bottom: 1px solid var(--color-outline);
        }

        .comparison-table tr:hover {
            background: var(--color-surface-tone-2);
        }

        .comparison-table .habit-icon-cell {
            font-size: 20px;
            width: 40px;
        }

        .comparison-progress-bar {
            height: 6px;
            background: var(--color-outline);
            border-radius: var(--radius-full);
            overflow: hidden;
            margin-top: 4px;
        }

        .comparison-progress-fill {
            height: 100%;
            background: var(--color-primary);
            border-radius: var(--radius-full);
            transition: width var(--motion-slow);
        }

        /* Insights Cards */
        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .insight-card {
            background: var(--color-surface-tone-2);
            border-radius: var(--radius-large);
            padding: 20px;
            box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3);
        }

        .insight-card h4 {
            font: var(--font-body);
            font-weight: var(--font-weight-medium);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .insight-card h4 .material-symbols-outlined {
            color: var(--color-primary);
            font-size: 20px;
        }

        .insight-list {
            list-style: none;
        }

        .insight-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 0;
            border-bottom: 1px solid var(--color-outline);
        }

        .insight-item:last-child {
            border-bottom: none;
        }

        .insight-item-icon {
            font-size: 24px;
        }

        .insight-item-content {
            flex: 1;
        }

        .insight-item-name {
            font-weight: var(--font-weight-medium);
        }

        .insight-item-stat {
            font: var(--font-label);
            color: var(--color-on-surface-variant);
            font-size: 12px;
        }

        .insight-item-badge {
            background: var(--color-primary);
            color: var(--color-on-primary);
            padding: 4px 8px;
            border-radius: var(--radius-full);
            font: var(--font-label);
            font-size: 11px;
            font-weight: var(--font-weight-medium);
        }

        /* Pattern Recognition */
        .pattern-card {
            background: var(--color-surface-tone-2);
            border-radius: var(--radius-large);
            padding: 20px;
            margin-bottom: 16px;
            border-left: 4px solid var(--color-primary);
        }

        .pattern-title {
            font: var(--font-body);
            font-weight: var(--font-weight-medium);
            margin-bottom: 8px;
        }

        .pattern-description {
            font: var(--font-label);
            color: var(--color-on-surface-variant);
            line-height: 1.5;
        }

        .pattern-stat {
            font-weight: var(--font-weight-medium);
            color: var(--color-primary);
        }

        /* Responsive adjustments for analytics */
        @media (max-width: 768px) {
            .analytics-tabs {
                overflow-x: scroll;
                -webkit-overflow-scrolling: touch;
            }

            .chart-wrapper {
                height: 250px;
            }

            .comparison-table {
                font-size: 12px;
            }

            .comparison-table th,
            .comparison-table td {
                padding: 8px;
            }
        }
    </style>
</head>

<body>

    <!-- Auth Screen -->
    <div class="auth-overlay" id="authOverlay">
        <div class="auth-modal">
            <h2 class="auth-title">
                <!-- Icon updated to new default -->
                <span class="material-symbols-outlined">task_alt</span>
                Habit Tracker
            </h2>
            <p class="auth-subtitle" id="authSubtitle">Sign in to sync your habits</p>

            <form id="authForm">
                <div class="input-group">
                    <label for="email" class="input-label">Email</label>
                    <input type="email" id="email" class="input-field" required autocomplete="email">
                </div>
                <div class="input-group">
                    <label for="password" class="input-label">Password</label>
                    <input type="password" id="password" class="input-field" required autocomplete="current-password">
                </div>

                <p class="auth-error" id="authError"></p>

                <div class="auth-actions">
                    <button type="button" class="filled-button state-layer-primary" id="authButton"
                        onclick="handleLoginClick()">Sign In</button>
                    <button type="button" class="toggle-auth state-layer-secondary" id="authToggle"
                        onclick="toggleAuthMode()">Need an account? Sign Up</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Main App Content -->
    <div class="app-container" id="appContainer">
        <!-- App Bar -->
        <div class="app-bar" id="appBar">
            <div class="app-bar-content">
                <div>
                    <div class="app-title">
                        <span class="material-symbols-outlined">task_alt</span>
                        Habit Tracker
                    </div>
                    <div class="app-subtitle">Build consistency, one day at a time</div>
                </div>
                <div class="app-bar-actions">
                    <!-- REFINEMENT: Principle #2 - Replace "Synced" with icon -->
                    <div class="sync-status" id="syncStatus" title="Sync Status">
                        <span class="material-symbols-outlined">cloud_done</span>
                    </div>

                    <!-- REFINEMENT: Principle #7 - Add Dark Mode Toggle -->
                    <button class="theme-toggle-button state-layer-on-primary" onclick="toggleDarkMode()"
                        aria-label="Toggle dark mode">
                        <span class="material-symbols-outlined" id="icon-light-mode">light_mode</span>
                        <span class="material-symbols-outlined" id="icon-dark-mode">dark_mode</span>
                    </button>

                    <button class="text-button state-layer-on-primary" onclick="handleSignOut()">Sign Out</button>
                </div>
            </div>
        </div>

        <div class="container">
            <!-- Setup Banner (for Firebase config) -->
            <div class="setup-banner" id="setupBanner">
                <h3>
                    <span class="material-symbols-outlined">settings</span>
                    Firebase Setup Required
                </h3>
                <p><strong>This app won't work without a Firebase backend.</strong> Follow these steps to enable secure
                    cloud sync:</p>
                <ol>
                    <li>Go to <a href="https://console.firebase.google.com" target="_blank">Firebase Console</a></li>
                    <li>Create a new project (free)</li>
                    <li>Enable <strong>Email/Password Authentication</strong> in Authentication â†’ Sign-in method</li>
                    <li>Create <strong>Firestore Database</strong> in production mode</li>
                    <li>Go to Firestore's <strong>Rules</strong> tab and replace the default rules with the ones from
                        the console warning.</li>
                    <li>Add a Web App (in Project Settings) and copy your config object into the
                        <code>firebaseConfig</code> variable in the code.</li>
                </ol>
                <p style="margin-top: 16px;"><strong>This banner will hide once you add your config.</strong></p>
            </div>

            <!-- Date Card -->
            <div class="date-card">
                <div class="date-header">
                    <div class="current-date" id="currentDate"></div>
                    <div class="date-subtext" id="dateSubtext"></div>
                </div>

                <div class="progress-ring-container">
                    <svg class="progress-ring" width="120" height="120">
                        <circle class="progress-ring-bg" cx="60" cy="60" r="52"></circle>
                        <circle class="progress-ring-circle" cx="60" cy="60" r="52" id="progressCircle"
                            style="stroke: var(--color-primary); stroke-dasharray: 326.73; stroke-dashoffset: 326.73;">
                        </circle>
                    </svg>
                    <div class="progress-text" id="progressText">0/0</div>
                </div>

                <div class="date-nav">
                    <button class="icon-button state-layer-secondary" onclick="changeDate(-1)"
                        aria-label="Previous day">
                        <span class="material-symbols-outlined">chevron_left</span>
                    </button>
                    <button class="today-button state-layer-primary" onclick="goToToday()">
                        <span class="material-symbols-outlined"
                            style="font-size: 18px; vertical-align: middle;">today</span>
                        Today
                    </button>
                    <button class="icon-button state-layer-secondary" onclick="changeDate(1)" id="nextDayBtn"
                        aria-label="Next day">
                        <span class="material-symbols-outlined">chevron_right</span>
                    </button>
                </div>
            </div>

            <!-- Habits Section -->
            <div class="habits-section" id="habitsList">
                <div class="habits-list-empty-state" id="emptyState">
                    <span class="material-symbols-outlined">add_task</span>
                    <h3>Your habit list is empty</h3>
                    <p>Click the <strong>+</strong> button in the corner to add your first habit!</p>
                </div>
                <!-- Habits will be rendered here by JavaScript -->
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid">
                <!-- Added style for stagger animation -->
                <div class="stat-card" style="--index: 1;">
                    <!-- REFINEMENT: Principle #2 & 4 - Semantic/Colored Icons -->
                    <div class="stat-icon" id="weekProgressIcon">
                        <span class="material-symbols-outlined">calendar_month</span>
                    </div>
                    <div class="stat-value" id="weekProgress">0%</div>
                    <div class="stat-label">This Week</div>
                </div>
                <div class="stat-card" style="--index: 2;">
                    <div class="stat-icon" id="totalCheckinsIcon">
                        <span class="material-symbols-outlined">task_alt</span>
                    </div>
                    <div class="stat-value" id="totalCheckins">0</div>
                    <div class="stat-label">Total Check-ins</div>
                </div>
                <div class="stat-card" style="--index: 3;">
                    <div class="stat-icon" id="bestStreakIcon">
                        <span class="material-symbols-outlined">local_fire_department</span>
                    </div>
                    <div class="stat-value" id="bestStreak">0</div>
                    <div class="stat-label">Best Streak</div>
                </div>
                <div class="stat-card" style="--index: 4;">
                    <div class="stat-icon" id="avgCompletionIcon">
                        <span class="material-symbols-outlined">leaderboard</span>
                    </div>
                    <div class="stat-value" id="avgCompletion">0%</div>
                    <div class="stat-label">Avg Rate</div>
                </div>
            </div>

            <!-- Analytics Dashboard -->
            <div class="analytics-tabs">
                <button class="analytics-tab active" onclick="switchAnalyticsTab('overview')">
                    <span class="material-symbols-outlined">dashboard</span>
                    Overview
                </button>
                <button class="analytics-tab" onclick="switchAnalyticsTab('heatmap')">
                    <span class="material-symbols-outlined">grid_on</span>
                    Heatmap
                </button>
                <button class="analytics-tab" onclick="switchAnalyticsTab('trends')">
                    <span class="material-symbols-outlined">trending_up</span>
                    Trends
                </button>
                <button class="analytics-tab" onclick="switchAnalyticsTab('insights')">
                    <span class="material-symbols-outlined">lightbulb</span>
                    Insights
                </button>
                <button class="analytics-tab" onclick="switchAnalyticsTab('compare')">
                    <span class="material-symbols-outlined">compare_arrows</span>
                    Compare
                </button>
            </div>

            <!-- Analytics Content Sections -->

            <!-- Overview Tab -->
            <div class="analytics-content active" id="overview-content">
                <div class="analytics-mini-stats">
                    <div class="mini-stat-card">
                        <div class="mini-stat-value" id="miniTotalHabits">0</div>
                        <div class="mini-stat-label">Active Habits</div>
                    </div>
                    <div class="mini-stat-card">
                        <div class="mini-stat-value" id="miniTodayCompleted">0</div>
                        <div class="mini-stat-label">Today Completed</div>
                    </div>
                    <div class="mini-stat-card">
                        <div class="mini-stat-value" id="miniTodayRate">0%</div>
                        <div class="mini-stat-label">Today's Rate</div>
                    </div>
                    <div class="mini-stat-card">
                        <div class="mini-stat-value" id="miniCurrentStreak">0</div>
                        <div class="mini-stat-label">Current Streak</div>
                    </div>
                    <div class="mini-stat-card">
                        <div class="mini-stat-value" id="miniMonthProgress">0%</div>
                        <div class="mini-stat-label">This Month</div>
                    </div>
                    <div class="mini-stat-card">
                        <div class="mini-stat-value" id="miniConsistency">0%</div>
                        <div class="mini-stat-label">Consistency</div>
                    </div>
                </div>

                <div class="chart-card">
                    <h3>
                        <span class="material-symbols-outlined">show_chart</span>
                        7-Day Trend
                    </h3>
                    <div class="chart-wrapper">
                        <canvas id="sevenDayTrendChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h3>
                        <span class="material-symbols-outlined">donut_small</span>
                        Today's Progress
                    </h3>
                    <div class="chart-wrapper small">
                        <canvas id="todayDonutChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h3>
                        <span class="material-symbols-outlined">bar_chart</span>
                        Monthly Performance (Last 6 Months)
                    </h3>
                    <div class="chart-wrapper">
                        <canvas id="monthlyPerformanceChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Enhanced Heatmap Tab -->
            <div class="analytics-content" id="heatmap-content">
                <div class="heatmap-filters">
                    <div class="filter-group">
                        <label>Period:</label>
                        <select id="heatmapPeriodFilter" class="filter-select" onchange="updateEnhancedHeatmap()">
                            <option value="3">3 Months</option>
                            <option value="6" selected>6 Months</option>
                            <option value="12">1 Year</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Habit:</label>
                        <select id="heatmapHabitFilter" class="filter-select" onchange="updateEnhancedHeatmap()">
                            <option value="all">All Habits</option>
                        </select>
                    </div>
                </div>

                <div class="chart-card">
                    <div id="enhancedHeatmapGrid"></div>
                    <div class="heatmap-legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: var(--color-surface-tone-3); opacity: 0.25;">
                            </div>
                            <span>0-25%</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: var(--color-primary); opacity: 0.5;"></div>
                            <span>26-50%</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: var(--color-primary); opacity: 0.75;"></div>
                            <span>51-75%</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: var(--color-primary); opacity: 1;"></div>
                            <span>76-100%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Trends Tab -->
            <div class="analytics-content" id="trends-content">
                <div class="chart-card">
                    <h3>
                        <span class="material-symbols-outlined">timeline</span>
                        30-Day Completion Trend
                    </h3>
                    <div class="chart-wrapper">
                        <canvas id="thirtyDayTrendChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h3>
                        <span class="material-symbols-outlined">local_fire_department</span>
                        Streak Timeline
                    </h3>
                    <div class="chart-wrapper large">
                        <canvas id="streakTimelineChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Insights Tab -->
            <div class="analytics-content" id="insights-content">
                <div class="insights-grid">
                    <div id="topPerformersContainer" style="display: flex; flex-direction: column; gap: 16px;">
                        <!-- Generated by JS -->
                    </div>

                    <div id="needsAttentionContainer" style="display: flex; flex-direction: column; gap: 16px;">
                        <!-- Generated by JS -->
                    </div>
                </div>

                <div class="chart-card">
                    <h3>
                        <span class="material-symbols-outlined">calendar_view_week</span>
                        Best Days of the Week
                    </h3>
                    <div class="chart-wrapper">
                        <canvas id="bestDaysChart"></canvas>
                    </div>
                </div>

                <div id="patternRecognitionContainer" style="display: flex; flex-direction: column; gap: 16px;">
                    <!-- Generated by JS -->
                </div>
            </div>

            <!-- Compare Tab -->
            <div class="analytics-content" id="compare-content">
                <div class="chart-card">
                    <h3>
                        <span class="material-symbols-outlined">table_chart</span>
                        Habit Comparison
                    </h3>
                    <table class="comparison-table" id="comparisonTable">
                        <thead>
                            <tr>
                                <th>Habit</th>
                                <th>This Week</th>
                                <th>This Month</th>
                                <th>Current Streak</th>
                                <th>Best Streak</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Generated by JS -->
                        </tbody>
                    </table>
                </div>

                <div class="chart-card">
                    <h3>
                        <span class="material-symbols-outlined">stacked_line_chart</span>
                        Head-to-Head (Last 14 Days)
                    </h3>
                    <div class="compare-selects"
                        style="display: flex; gap: 16px; margin-bottom: 16px; align-items: center;">
                        <div style="flex: 1;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500;">Habit 1:</label>
                            <select id="compareHabit1" class="filter-select" style="width: 100%;">
                                <!-- Generated by JS -->
                            </select>
                        </div>
                        <div style="flex: 1;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 500;">Habit 2:</label>
                            <select id="compareHabit2" class="filter-select" style="width: 100%;">
                                <!-- Generated by JS -->
                            </select>
                        </div>
                    </div>
                    <div class="chart-wrapper large">
                        <canvas id="headToHeadChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Export Section -->
            <div class="export-section">
                <h3>
                    <!-- REFINEMENT: Principle #6 - Change icon -->
                    <span class="material-symbols-outlined" style="vertical-align: middle;">cloud_download</span>
                    Export Your Data
                </h3>
                <p>Download your complete habit history as a CSV file</p>
                <button class="filled-button state-layer-primary" onclick="exportToCSV()">
                    <span class="material-symbols-outlined"
                        style="font-size: 18px; vertical-align: middle;">file_download</span>
                    Download CSV
                </button>
                <!-- REFINEMENT: Principle #6 - Add privacy note -->
                <p class="export-privacy-note">Your data stays privateâ€”exported only to your device.</p>
            </div>
        </div>
    </div>

    <!-- FAB -->
    <button class="fab state-layer-on-primary" onclick="openHabitModal()" aria-label="Add new habit" id="fabButton">
        <span class="material-symbols-outlined">add</span>
    </button>

    <!-- Celebration Overlay -->
    <div class="celebration" id="celebration">
        <div class="celebration-emoji">ðŸŽ‰</div>
        <div class="celebration-text">All habits completed!</div>
        <div class="celebration-subtext">Keep up the amazing work!</div>
    </div>

    <!-- REFINEMENT: Principle 7 - Confetti Container -->
    <div class="confetti-container" id="confettiContainer"></div>

    <!-- Snackbar -->
    <div class="snackbar" id="snackbar">
        <span class="material-symbols-outlined" id="snackbarIcon">check_circle</span>
        <span id="snackbarText"></span>
    </div>

    <!-- Add/Edit Habit Modal -->
    <div class="modal-overlay" id="habitModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="habitModalTitle">Add New Habit</h3>
                <button class="icon-button state-layer-secondary" onclick="closeHabitModal()" style="box-shadow: none;">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="habitForm">
                    <input type="hidden" id="habitIdInput">

                    <!-- REFINEMENT: Principle 4 - "I will..." -->
                    <div class="form-group">
                        <label for="habitName" class="form-label">I will...</label>
                        <input type="text" id="habitName" class="form-input" placeholder="e.g., Read 10 pages" required>
                    </div>

                    <div class="form-group">
                        <label for="habitIcon" class="form-label">Icon (Emoji)</label>
                        <input type="text" id="habitIcon" class="form-input" placeholder="e.g., ðŸ“š" required>
                    </div>

                    <!-- REFINEMENT: Principle 4 - "so I become..." -->
                    <div class="form-group">
                        <label for="habitWhy" class="form-label">...so I can (Your 'Why' - Optional)</label>
                        <input type="text" id="habitWhy" class="form-input" placeholder="e.g., learn a new skill">
                    </div>

                    <div class="form-group">
                        <label for="habitSchedule" class="form-label">Schedule</label>
                        <select id="habitSchedule" class="form-select">
                            <option value="daily">Daily</option>
                            <option value="weekdays">Weekdays Only (Mon-Fri)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Color</label>
                        <div class="color-picker" id="colorPicker">
                            <!-- Swatches added by JS -->
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="outlined-button state-layer-primary" onclick="closeHabitModal()">Cancel</button>
                <button class="filled-button state-layer-primary" onclick="saveHabit()">Save Habit</button>
            </div>
        </div>
    </div>

    <!-- Heatmap Modal -->
    <div class="modal-overlay" id="heatmapModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="heatmapTitle">Habit Consistency</h3>
                <button class="icon-button state-layer-secondary" onclick="closeHeatmapModal()"
                    style="box-shadow: none;">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="heatmap-grid" id="heatmapGrid">
                    <!-- Days will be generated by JS -->
                </div>
                <div class="heatmap-legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--color-surface-tone-3);"></div>
                        <span>Less</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: var(--habit-color);" id="heatmapLegendColor"></div>
                        <span>More</span>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script type="module" src="assets/js/firebase-config.js"></script>
    <script type="module" src="assets/js/app.js"></script>
</body>

</html>